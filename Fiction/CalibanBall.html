<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>calibanball – Fergus Fettes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-e73ed75cf5e7a3fd855296a79e6d84f7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Fergus Fettes</span>
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../now.html"> 
<span class="menu-text">Now</span></a>
  </li>  
</ul>
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
            <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#grok-rewrite" id="toc-grok-rewrite" class="nav-link active" data-scroll-target="#grok-rewrite">Grok Rewrite</a>
  <ul class="collapse">
  <li><a href="#caliban-ball-geometries-unhinged" id="toc-caliban-ball-geometries-unhinged" class="nav-link" data-scroll-target="#caliban-ball-geometries-unhinged">Caliban Ball: Geometries Unhinged</a></li>
  </ul></li>
  <li><a href="#grok-again" id="toc-grok-again" class="nav-link" data-scroll-target="#grok-again">Grok again:</a>
  <ul class="collapse">
  <li><a href="#caliban-ball-fractals-of-flesh-and-fury" id="toc-caliban-ball-fractals-of-flesh-and-fury" class="nav-link" data-scroll-target="#caliban-ball-fractals-of-flesh-and-fury">Caliban Ball: Fractals of Flesh and Fury</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header>




<p>years later, at the Caliban Ball in Highgate, giddy with joy in the late night she realises why she feels so full of joy– she <em>sees</em> it, in the whirling dance of the Calibans, she <em>sees</em> the sacred geometry that was there all along, not just his form, its expressed in his nerves, his tissues, his <em>instincts</em>, right down to the smallest motion– you could spend a life not noticing– you rarely see a Caliban really move, never had the chance to watch them. There are no beings on Earth that can fight a Caliban– <em>except another Caliban</em>– and Calibans do not fight, they dance. They dance the dance of their childhood, learned from the earliest ages in the gyms where they are raised, a hybrid, in its initial formulas, of Jiu-Jitsu, Caipoeira and Fandango. The goal is never to fell the opponent, but always to push them. To read their body as they are reading yours, to understand them, to be <em>within</em> them as much as you are within yourself, to know their limits and together to set new limits, to find out what a body could do if it had a double, if it were more than it is. She had watched them all night, high up in the balconies, forgetting her cocktail, forgetting the other honoured guests. The earliest dances are simple skirmishes, testing and trying and tasting different combinations. But at this time in the night, each Caliban has found their partner, has found their <em>match</em> and the dance begins in earnest, a tormented tornadoe of piano and violin– (Ginastera’s second– were she an auralist she would hear the images of murder, death, suffering in the streets of Chile, of the haunted brutal history of that place. She couldn’t hear it, the music was a dissonant storm to her– but she could see it!)– translated by living flesh, she watched the rise and fall of every crescendo in the crowd below her– the room brutally hot, the air sizzling with the sweat of a hundred furnace-bodies, all the Calibans naked but for some tattoos and jewlery, she naked as well as the steam rose and settled in the balconies around her, unbearably hot, a boiler-room of brawn– the Calibans near outcropping their maximum operating temperatures, their limbs melted to an impossible suppleness, some couples flexing and bending one another into knots, some throwing one another bodily, hand always clasping one hand or limb, never sperating, hurling each other and themselves from one side of the space to the other– she <em>sees</em> it there, what she knows she knew, when she saw it in the wild nature when Caliban took her hunting, the bunch of the rabbits thigh, the startled dance of death, the frantic clash of mating birds, the snap and grab of spider and snake– it is <em>present</em>, the sacred geometry of biology, the valleys through morphospace where living things <em>move</em>, those minima they <em>inhabit</em>, where life <em>is</em></p>
<section id="grok-rewrite" class="level1">
<h1>Grok Rewrite</h1>
<section id="caliban-ball-geometries-unhinged" class="level3">
<h3 class="anchored" data-anchor-id="caliban-ball-geometries-unhinged">Caliban Ball: Geometries Unhinged</h3>
<p>Highgate’s belly, a glass-veined cavern throbbing under midnight’s skin. Victory perches, throne a cradle of sweat-slick velvet, her body a limp whisper, but her eyes—oh, those devouring voids, engineered gulfs sucking light like black holes. No turning, no blinking; she <em>devours</em> the whirl below, the Caliban Ball a seething pit of naked fire.</p>
<p>Giddy, giddy joy floods her, late-night revelation crashing like a wave she can’t name until it breaks—<em>she sees it</em>. Not just forms, not meat and bone, but the sacred geometry etched in every twitch, every nerve-spark, every instinct uncoiling like forbidden math. Lifetimes wasted not noticing; Calibans slink through the world leashed, shadows in human skins. But here? Unleashed. No earth-thing fights a Caliban except another— and they don’t fight. They <em>dance</em>. Childhood’s wild hybrid: Jiu-Jitsu’s sly grapples, Capoeira’s aerial lies, Fandango’s stamping fury. Never to crush, always to <em>thrust</em>—read the other’s pulse as your own, burrow inside their limits, explode them together into something doubled, tripled, infinite. What if a body had echoes? What if it <em>multiplied</em>?</p>
<p>All night she’s watched from the steam-choked balconies, cocktail forgotten, guests blurred ghosts. Early dances: skirmish-flicks, tasting pairings in feints and flips. But now—<em>now</em>—matches found, the real storm erupts. Ginastera’s second concerto rips the air, piano a murderous hammer, violin a screaming wound— she can’t hear the history, Chile’s blood-streets and haunted screams, but <em>sees</em> it: dissonance as visual tempest, crimson shards fracturing the space, death’s jagged edges slicing through flesh-motions.</p>
<p>The room boils, air a sizzling haze of furnace-sweat, hundred bodies naked-glistening, tattoos swirling like galaxy arms, jewelry flashing predator-fangs. She’s naked too, steam cloaking her like lover’s breath, heat unbearable, a brawn-blasted forge where limbs melt to liquid grace. Calibans teeter on thermal cliffs, bodies supple as molten glass—couples knotting into impossible pretzels, spines arching like breaking waves, hands clamped eternal, never parting. Hurlings: one flings the other across the floor, a comet-trail of sweat-sparks, caught mid-arc, spun back into frenzy. Rise-fall-crests of music mirrored in the mob—crescendos as bodily tsunamis, sweat-vapor twisting into fractal clouds that refract light into screaming rainbows.</p>
<p>And she <em>sees</em>—god, she sees—the geometry blooming, sacred and savage. Not hidden anymore, exploding in whorls: Fibonacci spirals in thigh-bunches, chaotic attractors in hip-pivots, morphospace valleys carved by every leap, every lock. Biology’s secret code, life’s grooves where things <em>thrive</em>, not still but <em>moving</em>, <em>inhabiting</em> the minima like fevered gods. It’s what she glimpsed hunting with him—the rabbit’s thigh exploding in death-dance frenzy, mating birds’ aerial clash a whirlwind of beaks and fury, spider’s snap-grab on snake, a venomous tango of coils and strikes. <em>Present</em>, here, amplified: the whirling tornado of flesh translating storm-notes into living fractals, each pair a universe birthing itself, pushing boundaries until bodies blur into one ecstatic smear.</p>
<p>Joy surges, unhinged, her massive eyes drowning in it—Calibans as cosmic dancers, instincts unfurling like black-hole event horizons, sucking her into the geometry’s heart. Heat pulses in her veins, steam veils her vision in giddy haze, and she laughs, silent, the revelation a wild unspooling: this is life, raw and doubled, geometry’s mad pulse, and she’s its witness, its devourer.</p>
</section>
</section>
<section id="grok-again" class="level1">
<h1>Grok again:</h1>
<section id="caliban-ball-fractals-of-flesh-and-fury" class="level3">
<h3 class="anchored" data-anchor-id="caliban-ball-fractals-of-flesh-and-fury">Caliban Ball: Fractals of Flesh and Fury</h3>
<p>Highgate’s glass-veined cavern claws at the night sky, a throbbing blister on London’s old bones. Victory arrives late, wheeled in by silent attendants, her throne a velvet snare that props her fragile form like a broken doll. The air hits her first—thick, musky, laced with anticipation—but it’s her eyes that feast, those vast engineered abysses pulling in every shadow, every glint. No need for movement; her gaze sweeps the ballroom like a predator’s scan, mapping the sprawl below: a pit of marble and mirrors, chandeliers dripping light like molten stars, balconies ringed with honored guests—directors with hungry stares, diplomats in silk masks, all buzzing with forbidden thrill.</p>
<p>Giddiness stirs early, a fizz in her chest as the first Calibans trickle onto the floor. Naked already, bodies etched with tattoos that twist like living vines, jewelry piercing skin like meteor scars. She’s drawn to strip too, the heat demanding it—steam rising from hidden vents, turning the air into a humid dream. Cocktails circulate, bitter elixirs that sharpen her sight, but she sips once and forgets, transfixed. The early dances are flirtations: loose circles of Calibans testing the waters, Jiu-Jitsu feints melting into Capoeira spins, Fandango stamps echoing like distant thunder. Pairs form and dissolve, bodies brushing in exploratory grapples—never to dominate, always to probe, to taste the other’s rhythm. She sees hints of it already, the sacred geometry peeking through: spirals in a hip-twist, golden ratios in a leap’s arc. But it’s playful, restrained, like cubs batting at shadows.</p>
<p>As the night deepens, the music creeps in—soft at first, strings whispering secrets. Guests murmur around her, a wiry director leaning close with gin-soaked breath: “They say it’s not dance, it’s communion. Ever seen one break?” She doesn’t answer; her eyes lock on a lone Caliban in the center, his form a coiled promise. The giddiness builds, joy bubbling unbidden, but she doesn’t chase it yet. Instead, she watches the pairings solidify—matches found in subtle nods, bodies syncing like puzzle pieces. The air thickens, sweat-mist coiling upward, clinging to her skin like a lover’s fog. One pair catches her: a scarred female with eyes like storm clouds, circling a broad-shouldered male whose tattoos pulse with hidden light. They clash gently at first, hands clasping in unbreakable vows, hurling each other in wide arcs—never separating, always connected, pushing limits like explorers charting unknown seas.</p>
<p>Drama simmers as the hours stretch. A ritual unveils itself, something she didn’t expect: the “Mirroring,” announced by a gong’s bone-deep hum. The chandeliers dim, mirrors angling to multiply the floor into infinite echoes. Calibans form a vast ring, and challengers emerge—pairs inviting rivals to interrupt, to weave in and amplify the dance. It’s electric, unhinged; Victory’s joy spikes, her massive eyes dilating to drink it all. The scarred female’s duo is challenged by a sleek pair, lithe and venomous, their movements sharp as blades. What starts as playful intrusion erupts: the challengers dart in, breaking the flow with aggressive spins, forcing the original pair to adapt or shatter. Hands clasp in a four-way knot, bodies twisting into a tormented vortex—Jiu-Jitsu locks bending spines to breaking points, Capoeira flips hurling forms skyward, Fandango stamps shaking the marble like earthquakes. The air sizzles, heat cresting as bodies near their thermal edges, limbs melting to impossible pliancy. One challenger slips, a near-fall that sends the group tumbling in a heap of laughter and snarls— but they rise, unbroken, the dance evolving into something fiercer, limits exploding outward.</p>
<p>Ginastera’s second concerto crashes in then, a dissonant storm that Victory can’t parse aurally—piano hammering like fractured bones, violin wailing like torn skies. But visually? It’s apocalypse: the music’s haunted history blooms as crimson fractals, Chile’s bloodied streets fracturing the air, death’s shadows elongating in every leap. The ballroom becomes a forge of flesh, sweat-vapor twisting into hallucinatory clouds—Victory’s eyes overload, visions unspooling. Dancers morph in her sight: the scarred female as a fractal deity, limbs branching into infinite arms; her partner a cosmic serpent, coils unfurling in golden spirals. Couples knot into living mandalas, hurling each other across the space— one pair catapults apart almost to breaking, hands straining like cosmic tethers, then snapping back into a whirlwind embrace. The heat is unbearable now, a boiler of brawn where steam veils everything in giddy haze; guests fan themselves, some fleeing the balconies, but Victory leans forward, joy surging wild and heady.</p>
<p>And then—the revelation hits, not as thought but as visual thunder. She <em>sees</em> it, the sacred geometry that was always there, exploding in every nerve, every tissue, every instinct down to the smallest quiver. Not just forms, but the code of life itself: valleys through morphospace where beings <em>move</em>, <em>inhabit</em>, thriving in minima of motion. It’s what she glimpsed hunting in the wild—the rabbit’s thigh bunching in startled death-dance, mating birds clashing in aerial fury, spider snapping at snake in venomous tango. But here, amplified to madness: Calibans as embodiments of those grooves, pushing each other to redefine them, bodies doubling, tripling into ecstatic multiples. No earth-thing fights them except their own kind—and they don’t fight, they <em>transcend</em>, reading pulses like shared souls, burrowing into limits to birth new ones.</p>
<p>The night peaks in chaos: the challenged pair absorbs their rivals, the four becoming a tornado of limbs, spinning so fast the mirrors shatter illusions into a kaleidoscope of flesh. A misstep—a hand slips, a body hurtles toward the edge, crashing near the balconies with a thud that shakes Victory’s throne. Gasps ripple, but the dancer rises, laughing, pulling others back in. The joy in her chest boils over, unhinged laughter bubbling silent from her lips— this is it, life’s raw pulse, geometry’s mad heart, and she’s drowning in it, her eyes feasting on the fractal storm.</p>
<p>As the concerto fades, the dances unwind, bodies collapsing in steaming heaps, the air cooling to a humid sigh. Victory signals her attendants, descending the balcony in a whir of mechanisms—something new, impulsive. The crowd parts; she wheels to the floor’s edge, where Hartcrane waits, sweat-glistening, his match dissolved. He kneels, eyes meeting her voids. No words; she reaches out, her slender hand clasping his, and in that touch, she shares the vision—geometry flowing between them like a private current. He smiles, fierce and knowing, and for a moment, they “dance” in stillness: her seeing, him embodying. The night stretches eternal in her mind, joy lingering like afterimages of stars.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="www.fergusfettes.com">This website</a> by Fergus Fettes is marked as <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/FergusFettes">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>