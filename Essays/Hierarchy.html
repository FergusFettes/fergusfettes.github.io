<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2024-06-26">

<title>Hierarchy or Cooperation? – Fergus Fettes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-e73ed75cf5e7a3fd855296a79e6d84f7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Fergus Fettes</span>
    </a>
  </div>
          <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../now.html"> 
<span class="menu-text">Now</span></a>
  </li>  
</ul>
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
            <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-cell" id="toc-the-cell" class="nav-link active" data-scroll-target="#the-cell">The Cell</a>
  <ul class="collapse">
  <li><a href="#the-two-views" id="toc-the-two-views" class="nav-link" data-scroll-target="#the-two-views">The Two Views</a></li>
  </ul></li>
  <li><a href="#the-organism" id="toc-the-organism" class="nav-link" data-scroll-target="#the-organism">The Organism</a>
  <ul class="collapse">
  <li><a href="#the-two-views-1" id="toc-the-two-views-1" class="nav-link" data-scroll-target="#the-two-views-1">The Two Views</a></li>
  </ul></li>
  <li><a href="#the-state" id="toc-the-state" class="nav-link" data-scroll-target="#the-state">The State</a>
  <ul class="collapse">
  <li><a href="#the-two-views-2" id="toc-the-two-views-2" class="nav-link" data-scroll-target="#the-two-views-2">The Two Views</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Hierarchy or Cooperation?</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 26, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>A lot of difficulties between parties seems to be derived from different ways of understanding the world. On the one hand, life is seen as a Darwinian struggle between competing agents, and survival and flourishing is determined top-down by the will of the individual. On the other hand it is suggested by some that cooperation and collective action can stand as the foundation for a better or more just or more efficient system.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="./../_images/Necker_cube.svg" class="img-fluid figure-img"></p>
<figcaption><a href="https://en.wikipedia.org/wiki/Necker_cube">Necker Cube</a></figcaption>
</figure>
</div>
<p>It seems to me that these competing views are sometimes like different polarities of the Necker cube– if you hold you mind in balance and observe the system, it can flip back and forth between different interpretations, and both can be true. Of course, there are some simple distortions you can do to a Necker cube to make one or another perception more dominant. Similarly, some systems present themselves in a way that leads more directly to one or another interpretation. But it seems like a useful exercise to practice this flipping, to see which mode of apprehension is more fitting to the circumstance, or if both have something valuable to contribute. Let’s try a few exercises.</p>
<section id="the-cell" class="level1">
<h1>The Cell</h1>
<p>The cell emerged from systems of autopoietic cycles, chemicals co-creating and stabilizing themselves and one-another. At some point RNA then DNA emerged, and the cell ossified into the present form– the nucleus guides all activity, the rest of the cell is a dynamic enacting of the stories in the nucleus. A fuller version of this history is available <a href="../Essays/CellEvolution.html">here</a></p>
<section id="the-two-views" class="level3">
<h3 class="anchored" data-anchor-id="the-two-views">The Two Views</h3>
<p>The hierarchical view of the eukaryotic cell goes something like this: the nucleus is the dictator of the microenvironment, and the proteins are its serfs, they act out its bidding literally deterministically, and have no say in the functioning of the cell.</p>
<p>However, there are some serious holes in this view. For one, how did this come about? It came about because the cooperating ensemble of proteins and other molecules collectively evolved to store more and more information in stable structures. They did this so that they would have a stable reference point from which to kick start their cycles in case they were disrupted, and to store dormant cycles that were not needed in the current environment. In this view, it seems much more like the dynamic instantiation of the autopoietic cycles whose abstract representation is stored in the nucleus are the key players here, and the nuclear acts as a sort of infrastructure, to make their activity more efficient and more reliable.</p>
<p>At this point lets introduce two terms:</p>
<ul>
<li>x-instant (cycle-instant): an abstract frozen representation (an information-structure analogue of) a dynamic process (such as the DNA patterns that store a specific autopoietic cycle)</li>
<li>x-instance (cycle-instance): an instantiation of such a process in matter (such as the set of proteins and chemicals that forms a specific instantiation of an autopoietic cycle)</li>
</ul>
<p>Is this dominance or cooperation? Who is ‘in charge’? The cycle-instant in the platonic world of the nucleus, or the cycle-instance in material reality? It seems clear that the material instantiation is primary, that that is where the work gets done. However, the nucleus stores the potential for many different material manifestations– so there are many more cycle-instants present in the cell than cycle-instances. In this sense, the nucleus seems primary.</p>
<p>How else can we pick apart the representations? There are two great freedoms that a cell has– to die<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> and to change<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>. Who decides when the cell dies? Apoptosis can be triggered by the environment, which can impact the dynamic parts of the cell such that they break down irrecoverably. Or the nucleus can trigger apoptosis in response to certain cues from the dynamic parts. Or some combination of both can occur.</p>
<p>And what about metastasis? Again, external triggers or internal triggers can cause a cell to undergo large-scale morphological changes, where different information structures from the nucleus are picked out and propagated into the activity.</p>
<p>Finally, it is also possible for the nucleus and its microenvironment to become decoupled, such that the processes that are read out from it fall into a different steady-state equilibrium or parts of its microenvironment start acting according to other instructions or plans, no longer guided by the nucleus (such as in the case of infection by a virus).</p>
<p>All in all, it seems the question of how best to understand the activity of the cell hinges on the situation that we want to understand, and the information we have regarding the causes and effects of that situation.</p>
</section>
</section>
<section id="the-organism" class="level1">
<h1>The Organism</h1>
<p>The organism emerged from a similar process from cooperative origins. Initially, communities of cells (such as bacterial colonies) developed group behaviours and collective strategies that were more efficient for the aggregate, mostly communicated chemically. They then formed simple mats and other aggregates which started to communicate with electric potentials. Eventually, the nervous system evolved, which became a more and more highly specialized communication protocol between the parts of the organism and information store. A fuller version of this is available <a href="../Essays/OrganismEvolution.html">here</a>.</p>
<section id="the-two-views-1" class="level3">
<h3 class="anchored" data-anchor-id="the-two-views-1">The Two Views</h3>
<p>As an organism with a self, it is easy to fall into the trap of understanding the body as a collection of cellular serfs who exist to do your bidding. In other terms, the cells of the body become less and less agentic, deterministically carrying out orders given to them by the nervous system.</p>
<p>However, there are serious holes in this view. How did this situation come about? Over evolutionary time, cells noticed or decided or determined that offloading more and more of their agency and knowledge to one central repository was efficient, and suited their purposes well– they could remain in a comfortable homeostasis, with appropriate temperature and chemical composition, comfortably maintaining their local cellular microenvironments. It didn’t matter if they were deep under the sea or in the arctic circle– situations in which they would have struggled to flourish on their own in such large numbers– they would be safe and productive and have many offspring.</p>
<p>At the organism level the dark side of the bargain is more clear– some cells live short, difficult lives. The cells on the skin of the face of an arctic predator for example, would reproduce quickly and often find themselves annihilated by wind or cold or hard surfaces (or teeth or claws!) The dynamic cellular collective suffers– by definition– much more than the stable cells in the brain (immortal on organism timescales, statically managing their information flows).</p>
<p>This situation is of course the same in the microenvironment of the cell– the DNA seems much more persistent, and since ‘what persists exists’, doesn’t this imply that the stable information structures are the real winners here, the DNA in the case of the cell or the neurons in the case of the organism?</p>
<p>Again it seems we have this duality in play– on the one hand, in the organism, you have patterns of activity (behaviours, hormone cycles, stages of development, gross morphologies) that are stored in the brain. Lets call these all morpho-instants since most things can be called a morphology in some sense, stable on some timescale (examples: the bunched muscles of a flight-or-fight instinct are short timescale morphologies, the changing coats or hibernation patterns across seasons are long-timescale morphologies). The brain stores these morpho-instants. The body reads them out from the brain and produces morpho-instances appropriate for the given circumstance.</p>
<p>But this is a crucially two-directional process. The brain doesn’t arbitrarily pick morph-instants with the roll of the dice. It often chooses them based on the information coming in from the body– a certain combination of temperature and satiety levels perhaps start to trigger the hibernation-instant. Visual or auditory perceptions trigger the flight-instant. It would be quite easy to interpret this as a body processing its environmental cues though the medium of the information storage capacity of the brain, to choose from its repertoire of morpho-instants.</p>
<p>It isn’t that simple of course, and sometimes the relationship can be more dominated by the brain, or at least by very tightly coupled feedback loops– especially in creatures such as ourselves, with enormously overgrown brains. It could be argued that our brains have some almost-self-triggering morpho-instants, where we dump certain chemicals into body regions to create longer timescale feedback loops that trigger more information processing to trigger still different morphologies. (Emotion could be something like this.) This could be seen as a way of hopping from morphological minima across large regions of the morphospace– in human organisms, this could result in a complete change in lifestyle, environment, partners, diet, gross morphology etc. (Think about going through a mid-life crisis and starting to exercise regularly and moving to another country.)</p>
<p>These last paragraphs are of course the organisms manifestation of the two great freedoms– to die or to change. But it isn’t clear whether they can best be understood as having their origin in the body, the brain, or the environment. It seems clear you could describe some of these behaviours equally well as either hierarchical or cooperative. Some perhaps lend themselves more to hierarchy– such as when a person chooses of their free will to act in some manner that is derived almost entirely from memory, such as ‘I will now buy a Ryaniar ticket to Morocco’. Some perhaps lend themselves more to cooperation, such as exercise, lovemaking or drug use, which involve both a decision and a reward by the entire brain-body system.</p>
<p>Whether we choose to see behaviours as cooperative or hierarchical depends on the situation under observation and what we know about the system we are observing and its desires, ambitions and state of knowledge. Sometimes both views are equally informative and sometimes one is more useful than the other.</p>
<p>One more quick note on skin cells, and other short-lived ‘sacrificial’ cells. On the organism level it could be useful to see things in more abstract terms. Forgetting the material substace at work, and looking at morpho-instances. Imagine a person in some configuration– they are pushing another person on a swing say. Later they are lying in the grass reading a book. Only one of these configurations can exist at any moment– do we mourn the other? For one thing, we know we can often recover ‘lost’ morphologies– we can return to them. For another, as long as we persist in some reasonably painless morphology or other, some core of our process is satisfied. Does this help us with the skin cells? For one thing, all those deaths happen to keep their ancestor cells alive, which can produce more skin cells. For another, even if we think from the perspective of the skin cells and their endless turmoil, they ‘know’ in some abstract sense that the rest of the body is persisting (and shares their DNA). And is it really a sacrifice? Does the red blood cell undergo a little death when it loses its nucleus? Should we mourn them then, or when we bleed and watch them dry out uslessly in the sun?</p>
</section>
</section>
<section id="the-state" class="level1">
<h1>The State</h1>
<p>It is helpful in these discussion that we have biology and that biology has so many lessons to teach us, and it costs so little to learn these lessons (an experiment on cooperation in bacteria costs very little time, energy or guilt, a trip on the beagle a little more but is still within the budget available to some billions of humans). Biology also conveniently has examples that are well-localized and well-contained. Of course, there are other examples within biology that are less distinct, such as chemical cycles between collections or aggregates of cells, which are stored not in any one cell but in the competing interactions between the information stored in many of them, or ecologies and ecosystems, where the behaviour that fits best is stored not in one brain or nervous system but between many.</p>
<p>With the state, we seem more firmly in the spaces between clearly-defined objects. It is more an ecosystem level entity. It nevertheless seems like it can be approached with a very similar analysis.</p>
<p>The state had its origins in the increasingly complex interactions between organisms. Organisms with advanced nervous systems were creating more and more complex behaviours with regards to one another, both instincts that were tuned to respond to members of other species, and intra-species instincts such as songs, mating habits, and ways of relating. Over the last 100ky this process was accelerated in humans and new evolutionary forces drove us to develop longer lives (to store more information, driven by inter-generation mating) and more complex forms of communication both between individuals (song, language) and between groups across space and time (symbols), driven by selection. At some point, the information density of the environment and the richness of the natural world<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> became so high that radically different forms of organisation became possible.</p>
<section id="the-two-views-2" class="level2">
<h2 class="anchored" data-anchor-id="the-two-views-2">The Two Views</h2>
<p>This is known as the agricultural revolution, and it transformed our species from a wide array of egalitarian, cooperative collectives into the hierarchical slave-making societies that we are so familiar with.</p>
<p>However, there are serious holes in this view. First of all, how did this come about? Agriculture can be seen as part of a very diverse set of methods by which humans store information in their environment. This costs time and energy, so just like in the cell or the organisms, developing these stable information structures (and here I’m just talking about ‘the farm’ or ‘the herd’– even a plowed field stores information) makes the dynamic system dependent on it. There is a relationship between the plowed field and the people in the environment very much like the relationship between the x-instant in DNA and the x-instance in the cellular microenvironment. The plowed field causes people to plant and harvest crops– and indeed, plow again the field– which in turn maintains the crops growing in the plowed field. The plowed-field is an society-instant (a static, stored pattern of behaviour of a large number of people). The sowing, harvesting and plowing are the society-instance.</p>
<p>And as these information structures intensify, they produce centralized repositories of information which grow in complexity and specialization. A just-so-story version of it would go something like: merchants, to facilitate trade between specialist farms, craftspersons, to produce tools, armed-forces to defend against other collectives etc. Eventually, these information structures become so dense and specialised that a priestly caste emerges that stores information for many different society-instants (warring, peace, festive, summer, winter). The different specialists create society-instances with reference to this information store.</p>
<p>Here it seems even more clear that the hierarchical image can be applied. Almost all large-scale agricultural empires went through a slave-making period. It seems difficult to argue with the view that the priest or warrior castes, whose business for many thousands of years in many parts of the world was to maintain large populations of slaves, is a hierarchical system of domination. This view would be like a specialized cell in a very specific niche where the coupling between cycle-instants in DNA and cycle-instances in the microenvironment were very tightly coupled and deterministic, and the environment could do little to change them. Or like a very specialized cell in the body that responded slowly or not at all to environmental changes, and just performed its work day-in-day-out with the same deterministic certainty, such as perhaps the muscles of the heart, which are shocked every moment with a command from the brain-stem (a morpho-instance tightly coupled to a morpho-instance), and perform unfailingly for up to a century.</p>
<p>There are of course parts of the system that seem more cooperative, such as the relationship between the craftspersons or warriors or merchants and the priestly castes. And, if we look at the setup from the perspective of instants and instances it is still ambiguous– DNA has no agency and no dynamism, neither do neurons. They are merely informational infrastructure that the cell or the body maintains for its own convenience. Even the heart is part of the feedback process that alters the body when the body bootstraps though a series of morpho-instances across morphospace. In this sense, like the oracles of Delphi or the British Royal Family, they are patterns of memory, society-instants that are stored and maintained by the state in case they are needed in a different environment. And as we see in times of conflict, the body has a voice and remains part of the feedback loop that allows a state to bootstrap from one society-instance to another across the space of possible forms.</p>
<p>And what of the two great freedoms? Do societies die, or change? It seems so. Perhaps the Roman Empire can be looked at as a society that reached its limits and died, with some of its parts becoming the Holy Roman Empire (Germany) or the Byzantine Empire (Turkey). Perhaps the British Empire would be another candidate for a state that chose to die. (Of course these processes are ‘bloody’– just as apoptosis of the cell results in the destruction and decay of many proteins and the death of an organism the death of every cell– thankfully states die much less violently than organisms do. Or rather their parts are more quickly and dynamically reused by the environment.)</p>
<p>And of course states can change drastically. Germany underwent metastasis in the 1930s. So did China. The state that existed before was gone. But while it would be easy to characterize these particular transitions as occurring in a hierarchical manner, in the case of Germany it seems clear from the historical record that the change was driven from the ground up– there were a wide array of political views and parties developing and competing, and from them all one particular society-instance emerged and directed the gross morphology of the state for some (few) years. (It was clearly a bad choice, needless to say.) Hitler did not emerge in a vacuum, he was called forth by the political turmoil of the time, he was very much a product of his environment.</p>
<p>And China? From the perspective of the state, the unthinkable had happened– a state that had had no interest in the outside world for thousands of years, because it was so far ahead of them in every way, suddenly looked outside of its walls and noticed something was happening. And then the outside world burst in on its domain with colonization and war. What choice did it have, but to radically and violently evolve? Is it conceivable that this was driven by ‘one man’? Of course not, the entire organism chose to respond to environmental changes by searching for a new morphology. Again, it doesn’t seem like the best choice from the perspective of eg. the peasant farmers, who would die in their millions. But viewing it as a top-down hierarchical process seems to me to be a bizarre way of interpreting the historical evidence.</p>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<p>It seems there is no perfect understanding of the world that will make everything clear and comprehensible in simple terms. There are many situations where different perspectives are called for, to tease out different aspects of the matter at hand. And it also seems that there are a great many lessons out there in different scales within the biosphere that help us understand its dynamics and behaviour. Some lessons are easier to amplify and find echos or analogues of at different scales, and whatever we hope to understand we should look for these analogues, particularly in systems that we can easily experiment with or observe. Some situations seems to fit into an archetype very clearly and cleanly, and when this happens we should exploit the tropes and narrative structures native to that archetype as well as we can and as long as they are fruitful, to understand the topic. But in many cases there are many frames and interpretations that are germane and we should try to actively pick and choose between them to the extent that they each benefit us.</p>
</section>
<section id="references" class="level1">
<h1>References</h1>
<ul>
<li><a href="https://arxiv.org/ftp/arxiv/papers/2311/2311.09589.pdf">Mortal Computation</a>: this paper has nice descriptions of homeostasis and alleostasis</li>
<li><a href="file:///home/ffettes/Downloads/EPIA_2023_LG_JB%20very%20final-w-ref.pdf">A Path to Generative Artificial Selves</a>: possibly relevant</li>
</ul>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Apoptosis: From the Greek “apo” (από) meaning “away from” and “ptosis” (πτώσις) meaning “falling,” referring to the falling of leaves from trees. In this context, it symbolizes the natural process of cell death as a part of an organism’s growth and development.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>From the Greek “meta” (μετά) meaning “after” or “beyond” and “stasis” (στάσις) meaning “standing” or “placement.” In the context of cancer, it refers to the spread of cancer cells from their original site to other parts of the body.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Around 10kya after the ice-age the climate was very warm, wet and stable for a long time– the Holocene– and this likely provided the impetus for the developments known as ‘the rest of history’. Of course the information-structures were already being developed before then.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p><a href="www.fergusfettes.com">This website</a> by Fergus Fettes is marked as <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/FergusFettes">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>